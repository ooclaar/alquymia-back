{% extends "base.html" %}

{% block stylesheets %}
{{ super() }}
<style>
    .teams-page {
        background: linear-gradient(135deg, #0a0e27 0%, #1a1f3a 100%);
    }
</style>
{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="challenges-hero">
    <div class="event-badge" style="display: inline-block; font-family: 'Orbitron', sans-serif; font-size: 0.9rem; font-weight: 600; padding: 0.6rem 1.5rem; border: 2px solid #FF8C00; border-radius: 50px; color: #FF8C00; letter-spacing: 2px; margin-bottom: 2rem; text-transform: uppercase; box-shadow: 0 0 20px rgba(255, 140, 0, 0.3);">4ª EDIÇÃO</div>
    <h1 class="glitch" data-text="EQUIPES">EQUIPES</h1>
    <p class="subtitle">Conheça todas as equipes participantes do CTF</p>
</section>

<!-- Teams Section -->
<section class="leaderboard-section">
    <div class="container">

        <!-- Teams Table -->
        <div class="row">
            <div class="col-md-12">
                <h2 class="section-title">Todas as Equipes</h2>
                
                <div class="leaderboard-table">
                    <div class="table-header">
                        <div class="col-team" style="flex: 2;">Equipe</div>
                        <div class="col-rank" style="flex: 0.5;">Site</div>
                        <div class="col-points d-none d-md-block" style="flex: 1.5;">Afiliação</div>
                        <div class="col-rank d-none d-md-block" style="flex: 1;">País</div>
                    </div>

                    {% for team in teams.items %}
                        <div class="table-row">
                            <div class="col-team" style="flex: 2;">
                                <div class="team-info">
                                    <div class="team-avatar">{{ team.name[:2].upper() }}</div>
                                    <div class="team-details">
                                        {% if scores_visible() %}
                                            <a href="{{ url_for('teams.public', team_id=team.id) }}" class="team-name">
                                                {{ team.name | truncate(50) }}
                                            </a>
                                        {% else %}
                                            <span class="team-name">{{ team.name | truncate(50) }}</span>
                                        {% endif %}
                                        
                                        {% if team.bracket_id %}
                                            <span class="badge bg-secondary ms-2">{{ team.bracket.name }}</span>
                                        {% endif %}
                                        
                                        {% if team.oauth_id %}
                                            <a href="https://majorleaguecyber.org/t/{{ team.name }}" target="_blank">
                                                <span class="badge bg-primary ms-2">Oficial</span>
                                            </a>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-rank" style="flex: 0.5; text-align: center;">
                                {% if team.website and (team.website.startswith('http://') or team.website.startswith('https://')) %}
                                    <a href="{{ team.website }}" target="_blank" rel="noopener" class="text-primary">
                                        <i class="fas fa-external-link-alt" 
                                           data-bs-toggle="tooltip" 
                                           data-bs-placement="top" 
                                           title="{{ team.website }}"></i>
                                    </a>
                                {% else %}
                                    <span class="text-muted">-</span>
                                {% endif %}
                            </div>
                            
                            <div class="col-points d-none d-md-block" style="flex: 1.5;">
                                {% if team.affiliation %}
                                    {% if team.affiliation | length > 50 %}
                                        <span data-bs-toggle="tooltip" 
                                              data-bs-placement="top" 
                                              title="{{ team.affiliation }}">
                                            {{ team.affiliation | truncate(50) }}
                                        </span>
                                    {% else %}
                                        <span>{{ team.affiliation }}</span>
                                    {% endif %}
                                {% else %}
                                    <span class="text-muted">-</span>
                                {% endif %}
                            </div>
                            
                            <div class="col-rank d-none d-md-block" style="flex: 1;">
                                {% if team.country %}
                                    <i class="flag-{{ team.country.lower() }}"></i>
                                    {{ lookup_country_code(team.country) }}
                                {% else %}
                                    <span class="text-muted">-</span>
                                {% endif %}
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        <!-- Pagination -->
        {% if teams.pages > 1 %}
            <div class="row mt-4">
                <div class="col-md-12">
                    <div class="text-center">
                        <div class="pagination-container">
                            {% if teams.page != 1 %}
                                <a href="{{ prev_page }}" class="btn btn-outline-primary">
                                    <i class="fas fa-chevron-left"></i> Anterior
                                </a>
                            {% endif %}

                            <select class="form-select page-select mx-3" style="width: auto; display: inline-block;">
                                {% for page in range(1, teams.pages + 1) %}
                                    <option value="{{ page }}" {% if teams.page == page %}selected{% endif %}>
                                        Página {{ page }}
                                    </option>
                                {% endfor %}
                            </select>

                            {% if teams.next_num %}
                                <a href="{{ next_page }}" class="btn btn-outline-primary">
                                    Próxima <i class="fas fa-chevron-right"></i>
                                </a>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}
    </div>
</section>

<style>
.pagination-container {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 1rem;
    flex-wrap: wrap;
}

.page-select {
    background: rgba(30, 41, 59, 0.8);
    border: 2px solid rgba(148, 163, 184, 0.3);
    color: #ffffff;
    padding: 0.5rem 1rem;
    border-radius: 8px;
}

.page-select:focus {
    border-color: #ff6b35;
    box-shadow: 0 0 0 0.2rem rgba(255, 107, 53, 0.25);
}

.btn-outline-primary {
    border: 2px solid #ff6b35;
    color: #ff6b35;
    background: transparent;
    padding: 0.5rem 1.5rem;
    border-radius: 8px;
    transition: all 0.3s ease;
}

.btn-outline-primary:hover {
    background: #ff6b35;
    color: #ffffff;
    transform: translateY(-2px);
}

.form-select, .form-control {
    background: rgba(30, 41, 59, 0.8);
    border: 2px solid rgba(148, 163, 184, 0.3);
    color: #ffffff;
    border-radius: 10px;
    padding: 0.75rem 1rem;
}

.form-select:focus, .form-control:focus {
    background: rgba(30, 41, 59, 0.9);
    border-color: #ff6b35;
    box-shadow: 0 0 0 0.2rem rgba(255, 107, 53, 0.25);
    color: #ffffff;
}

.form-control::placeholder {
    color: #64748b;
}

.btn-primary {
    background: linear-gradient(135deg, #ff6b35 0%, #ff8c42 100%);
    border: none;
    color: #ffffff;
    font-weight: 600;
    padding: 0.75rem 1.5rem;
    border-radius: 10px;
    transition: all 0.3s ease;
}

.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 25px rgba(255, 107, 53, 0.3);
}

@media (max-width: 768px) {
    .pagination-container {
        flex-direction: column;
    }
    
    .page-select {
        width: 100%;
    }
}
</style>
{% endblock %}

{% block scripts %}
{{ Assets.js("assets/js/teams/list.js") }}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        document.body.classList.add('teams-page');
        
        // Handle page select change
        const pageSelect = document.querySelector('.page-select');
        if (pageSelect) {
            pageSelect.addEventListener('change', function() {
                const currentUrl = new URL(window.location.href);
                currentUrl.searchParams.set('page', this.value);
                window.location.href = currentUrl.toString();
            });
        }
    });
</script>
{% endblock %}

