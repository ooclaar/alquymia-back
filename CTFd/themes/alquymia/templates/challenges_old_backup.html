{% extends "base.html" %}

{% block content %}
<style>
/* Hero de Desafios */
.challenges-hero {
    padding: 8rem 2rem 4rem;
    text-align: center;
    position: relative;
    z-index: 10;
    background: linear-gradient(180deg, rgba(10, 10, 10, 0) 0%, rgba(10, 10, 10, 0.8) 100%);
}

.event-badge {
    display: inline-block;
    font-family: 'Orbitron', sans-serif;
    font-size: 0.9rem;
    font-weight: 600;
    padding: 0.6rem 1.5rem;
    border: 2px solid #FF8C00;
    border-radius: 50px;
    color: #FF8C00;
    letter-spacing: 2px;
    margin-bottom: 2rem;
    text-transform: uppercase;
    box-shadow: 0 0 20px rgba(255, 140, 0, 0.3);
}

.challenges-hero h1 {
    font-family: 'Orbitron', sans-serif;
    font-size: 4rem;
    font-weight: 700;
    color: #FF8C00;
    margin-bottom: 1rem;
    text-shadow: 0 0 30px rgba(255, 140, 0, 0.5);
    letter-spacing: 3px;
}

.challenges-hero .subtitle {
    font-family: 'Rajdhani', sans-serif;
    font-size: 1.3rem;
    color: #b0b0b0;
    margin-bottom: 3rem;
}

.hero-stats {
    display: flex;
    justify-content: center;
    gap: 4rem;
    flex-wrap: wrap;
}

.stat-box {
    padding: 1.5rem 2rem;
    background: rgba(26, 26, 26, 0.8);
    border: 1px solid rgba(255, 140, 0, 0.3);
    border-radius: 12px;
}

.stat-number {
    font-family: 'Orbitron', sans-serif;
    font-size: 2.5rem;
    font-weight: 700;
    color: #FF8C00;
    display: block;
}

.stat-label {
    font-family: 'Rajdhani', sans-serif;
    font-size: 1rem;
    color: #888;
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-top: 0.5rem;
}

/* Barra de Filtros */
.filter-bar {
    padding: 2rem;
    display: flex;
    justify-content: center;
    gap: 1rem;
    flex-wrap: wrap;
    position: relative;
    z-index: 10;
}

.filter-btn {
    font-family: 'Rajdhani', sans-serif;
    font-size: 1rem;
    font-weight: 600;
    padding: 0.8rem 2rem;
    background: rgba(26, 26, 26, 0.8);
    border: 2px solid rgba(255, 140, 0, 0.3);
    border-radius: 50px;
    color: #888;
    cursor: pointer;
    transition: all 0.3s ease;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.filter-btn:hover {
    border-color: #FF8C00;
    color: #FF8C00;
    background: rgba(255, 140, 0, 0.1);
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(255, 140, 0, 0.3);
}

.filter-btn.active {
    background: linear-gradient(135deg, #FF8C00 0%, #FFA500 100%);
    border-color: #FF8C00;
    color: #1a1a2e;
    box-shadow: 0 5px 20px rgba(255, 140, 0, 0.5);
}

.filter-btn .icon {
    margin-right: 0.5rem;
}

/* Grid de Desafios */
.challenges-grid {
    padding: 2rem;
    position: relative;
    z-index: 10;
}

.challenges-grid .container {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: 2rem;
    max-width: 1400px;
    margin: 0 auto;
}

/* Card de Desafio */
.challenge-card {
    background: linear-gradient(135deg, rgba(26, 26, 26, 0.95) 0%, rgba(10, 10, 10, 0.95) 100%);
    border: 1px solid rgba(255, 140, 0, 0.2);
    border-radius: 12px;
    padding: 1.5rem;
    transition: all 0.3s ease;
    cursor: pointer;
    position: relative;
    overflow: hidden;
}

.challenge-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, #FF8C00 0%, #FFA500 100%);
    opacity: 0;
    transition: opacity 0.3s ease;
}

.challenge-card:hover {
    border-color: #FF8C00;
    transform: translateY(-5px);
    box-shadow: 0 10px 30px rgba(255, 140, 0, 0.3);
}

.challenge-card:hover::before {
    opacity: 1;
}

/* Badges */
.challenge-badges {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 1rem;
    flex-wrap: wrap;
}

.badge {
    font-family: 'Rajdhani', sans-serif;
    font-size: 0.75rem;
    font-weight: 600;
    padding: 0.3rem 0.8rem;
    border-radius: 20px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.badge-category {
    background: rgba(255, 140, 0, 0.2);
    color: #FF8C00;
    border: 1px solid #FF8C00;
}

/* Cores por Categoria */
.badge-category.misc { background: rgba(255, 215, 0, 0.2); color: #FFD700; border-color: #FFD700; }
.badge-category.crypto,
.badge-category.criptografia { background: rgba(139, 69, 255, 0.2); color: #8B45FF; border-color: #8B45FF; }
.badge-category.forensics,
.badge-category.forense { background: rgba(255, 69, 0, 0.2); color: #FF4500; border-color: #FF4500; }
.badge-category.web { background: rgba(0, 150, 255, 0.2); color: #0096FF; border-color: #0096FF; }
.badge-category.stego,
.badge-category.esteganografia { background: rgba(255, 20, 147, 0.2); color: #FF1493; border-color: #FF1493; }
.badge-category.reverse { background: rgba(50, 205, 50, 0.2); color: #32CD32; border-color: #32CD32; }

.badge-difficulty {
    background: rgba(50, 205, 50, 0.2);
    color: #32CD32;
    border: 1px solid #32CD32;
}

.badge-difficulty.medium {
    background: rgba(255, 165, 0, 0.2);
    color: #FFA500;
    border-color: #FFA500;
}

.badge-difficulty.hard {
    background: rgba(255, 0, 0, 0.2);
    color: #FF0000;
    border-color: #FF0000;
}

.badge-solved {
    background: rgba(50, 205, 50, 0.2);
    color: #32CD32;
    border: 1px solid #32CD32;
}

/* Conte√∫do do Card */
.challenge-card h3 {
    font-family: 'Orbitron', sans-serif;
    font-size: 1.3rem;
    color: #e0e0e0;
    margin-bottom: 0.8rem;
}

.challenge-card p {
    font-family: 'Rajdhani', sans-serif;
    font-size: 1rem;
    color: #888;
    margin-bottom: 1rem;
    line-height: 1.5;
}

.challenge-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-top: 1rem;
    border-top: 1px solid rgba(255, 140, 0, 0.2);
}

.challenge-points {
    font-family: 'Orbitron', sans-serif;
    font-size: 1.2rem;
    font-weight: 700;
    color: #FF8C00;
}

.challenge-solves {
    font-family: 'Rajdhani', sans-serif;
    font-size: 0.9rem;
    color: #666;
}

/* Loading */
.loading {
    text-align: center;
    padding: 4rem 2rem;
}

.spinner {
    width: 50px;
    height: 50px;
    border: 4px solid rgba(255, 140, 0, 0.2);
    border-top-color: #FF8C00;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin: 0 auto;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

/* Responsivo */
@media (max-width: 768px) {
    .challenges-hero h1 {
        font-size: 2.5rem;
    }
    
    .hero-stats {
        gap: 2rem;
    }
    
    .filter-bar {
        gap: 0.5rem;
    }
    
    .filter-btn {
        padding: 0.6rem 1.5rem;
        font-size: 0.9rem;
    }
    
    .challenges-grid .container {
        grid-template-columns: 1fr;
    }
}
</style>

<div class="challenges-hero">
    <div class="event-badge">4¬™ EDI√á√ÉO</div>
    <h1>DESAFIOS CTF 2025</h1>
    <p class="subtitle">Explore os desafios divididos por categoria e teste suas habilidades</p>
    
    <div class="hero-stats">
        <div class="stat-box">
            <span class="stat-number">18+</span>
            <span class="stat-label">Desafios</span>
        </div>
        <div class="stat-box">
            <span class="stat-number">6</span>
            <span class="stat-label">Categorias</span>
        </div>
        <div class="stat-box">
            <span class="stat-number">3850+</span>
            <span class="stat-label">Pontos</span>
        </div>
    </div>
</div>

<!-- Barra de Filtros -->
<div class="filter-bar" x-data="{ selectedCategory: 'all' }">
    <button class="filter-btn" 
            :class="{ 'active': selectedCategory === 'all' }"
            @click="selectedCategory = 'all'">
        <span class="icon">üéØ</span> Todos
    </button>
    <button class="filter-btn" 
            :class="{ 'active': selectedCategory === 'Criptografia' }"
            @click="selectedCategory = 'Criptografia'">
        <span class="icon">üîê</span> Criptografia
    </button>
    <button class="filter-btn" 
            :class="{ 'active': selectedCategory === 'Web' }"
            @click="selectedCategory = 'Web'">
        <span class="icon">üåê</span> Web
    </button>
    <button class="filter-btn" 
            :class="{ 'active': selectedCategory === 'Forense' }"
            @click="selectedCategory = 'Forense'">
        <span class="icon">üîç</span> Forense
    </button>
    <button class="filter-btn" 
            :class="{ 'active': selectedCategory === 'Esteganografia' }"
            @click="selectedCategory = 'Esteganografia'">
        <span class="icon">üñºÔ∏è</span> Esteganografia
    </button>
    <button class="filter-btn" 
            :class="{ 'active': selectedCategory === 'Reverse' }"
            @click="selectedCategory = 'Reverse'">
        <span class="icon">‚öôÔ∏è</span> Reversing
    </button>
    <button class="filter-btn" 
            :class="{ 'active': selectedCategory === 'MISC' }"
            @click="selectedCategory = 'MISC'">
        <span class="icon">üé≤</span> MISC
    </button>
</div>

<!-- Grid de Desafios -->
<div class="challenges-grid" 
     x-data="ChallengeBoard" 
     @load-challenges.window="loadChallenges()" 
     @load-challenge.window="loadChallenge($event.detail)">
    
    <!-- Modal de Desafio -->
    <div x-ref="challengeWindow" 
         id="challenge-window" 
         class="modal fade" 
         tabindex="-1" 
         role="dialog" 
         x-data="" 
         x-html="$store.challenge.data.view">
    </div>
    
    <!-- Loading State -->
    <div x-show="!loaded" class="loading">
        <div class="spinner"></div>
        <p style="color: #888; margin-top: 1rem; font-family: 'Rajdhani', sans-serif;">Carregando desafios...</p>
    </div>
    
    <!-- Grid √önico de Desafios (sem separa√ß√£o por categoria) -->
    <div x-show="loaded" x-data="{ selectedCategory: 'all' }" @filter-category.window="selectedCategory = $event.detail">
        <div class="container">
            <template x-for="challenge in challenges" :key="challenge.id">
                <div class="challenge-card" 
                     :data-challenge-id="challenge.id"
                     x-show="selectedCategory === 'all' || selectedCategory === challenge.category"
                     style="cursor: pointer;">
                    <!-- Badges -->
                    <div class="challenge-badges">
                        <span class="badge badge-category" 
                              :class="challenge.category.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g, '')"
                              x-text="challenge.category"></span>
                        <span class="badge badge-difficulty"
                              :class="{ 
                                  'medium': challenge.tags && challenge.tags.includes('medium'),
                                  'hard': challenge.tags && challenge.tags.includes('hard')
                              }"
                              x-text="challenge.tags && challenge.tags.includes('hard') ? 'DIF√çCIL' : 
                                      challenge.tags && challenge.tags.includes('medium') ? 'M√âDIO' : 'F√ÅCIL'"></span>
                        <span class="badge badge-solved" 
                              x-show="challenge.solved_by_me"
                              style="display: none;">‚úì Resolvido</span>
                    </div>
                    
                    <!-- T√≠tulo -->
                    <h3 x-text="challenge.name"></h3>
                    
                    <!-- Descri√ß√£o -->
                    <p x-text="challenge.description || 'Sem descri√ß√£o dispon√≠vel'"></p>
                    
                    <!-- Footer -->
                    <div class="challenge-footer">
                        <span class="challenge-points" x-text="challenge.value + ' pontos'"></span>
                        <span class="challenge-solves" x-text="(challenge.solves || 0) + ' resolu√ß√µes'"></span>
                    </div>
                </div>
            </template>
        </div>
    </div>
</div>

<script>
// Sincronizar filtro entre componentes
document.addEventListener('alpine:init', () => {
    // Listener para mudan√ßa de filtro
    document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
            const category = e.currentTarget.textContent.trim().split(' ').slice(1).join(' ');
            window.dispatchEvent(new CustomEvent('filter-category', { 
                detail: category === 'Todos' ? 'all' : category 
            }));
        });
    });
});
</script>

{% endblock %}

{% block scripts %}
  {{ Assets.js("assets/js/challenges.js") }}
  
<script>
/**
 * Custom Challenge Modal for Alquymia Theme
 * Loads challenge data from CTFd API and renders a custom modal
 */

(function() {
    'use strict';
    
    // Fun√ß√£o para obter o token CSRF
    function getCSRFToken() {
        const tokenElement = document.querySelector('meta[name="csrf-token"]');
        return tokenElement ? tokenElement.content : '';
    }
    
    // Fun√ß√£o para buscar dados do desafio via API
    async function fetchChallengeData(challengeId) {
        try {
            const response = await fetch(`/api/v1/challenges/${challengeId}`, {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                }
            });
            
            if (!response.ok) {
                throw new Error('Erro ao carregar desafio');
            }
            
            const result = await response.json();
            return result.data;
        } catch (error) {
            console.error('Erro ao buscar desafio:', error);
            return null;
        }
    }
    
    // Fun√ß√£o para criar o HTML do modal customizado
    function createCustomModal(challenge) {
        // Determinar a cor do badge de categoria
        const categoryColors = {
            'Criptografia': 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
            'Web': 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)',
            'Forense': 'linear-gradient(135deg, #fa709a 0%, #fee140 100%)',
            'Esteganografia': 'linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)',
            'Reverse': 'linear-gradient(135deg, #30cfd0 0%, #330867 100%)',
            'MISC': 'linear-gradient(135deg, #ffd89b 0%, #19547b 100%)'
        };
        
        const categoryColor = categoryColors[challenge.category] || categoryColors['MISC'];
        
        // Determinar a cor do badge de dificuldade baseado nas tags
        let difficultyBadge = 'F√ÅCIL';
        let difficultyColor = 'linear-gradient(135deg, #11998e 0%, #38ef7d 100%)';
        
        if (challenge.tags && challenge.tags.length > 0) {
            const tag = challenge.tags[0].toLowerCase();
            if (tag.includes('easy') || tag.includes('f√°cil') || tag.includes('facil')) {
                difficultyBadge = 'F√ÅCIL';
                difficultyColor = 'linear-gradient(135deg, #11998e 0%, #38ef7d 100%)';
            } else if (tag.includes('medium') || tag.includes('m√©dio') || tag.includes('medio')) {
                difficultyBadge = 'M√âDIO';
                difficultyColor = 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)';
            } else if (tag.includes('hard') || tag.includes('dif√≠cil') || tag.includes('dificil')) {
                difficultyBadge = 'DIF√çCIL';
                difficultyColor = 'linear-gradient(135deg, #fa709a 0%, #fee140 100%)';
            }
        }
        
        // Criar HTML dos arquivos
        let filesHTML = '';
        if (challenge.files && challenge.files.length > 0) {
            filesHTML = `
                <div style="margin-bottom: 2rem;">
                    <h5 style="color: #FF8C00; font-family: 'Orbitron', sans-serif; font-size: 1.2rem; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                        üîó Link do Desafio
                    </h5>
                    <div style="display: flex; flex-direction: column; gap: 10px;">
                        ${challenge.files.map(file => `
                            <a href="${file}" target="_blank" class="btn" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 12px 24px; border-radius: 8px; text-decoration: none; display: inline-flex; align-items: center; gap: 10px; font-weight: 600; transition: all 0.3s ease; border: none; max-width: 250px;">
                                üöÄ Acessar Desafio
                            </a>
                        `).join('')}
                    </div>
                </div>
            `;
        }
        
        // Criar HTML da connection info
        let connectionHTML = '';
        if (challenge.connection_info) {
            connectionHTML = `
                <div style="margin-bottom: 2rem;">
                    <h5 style="color: #FF8C00; font-family: 'Orbitron', sans-serif; font-size: 1.2rem; margin-bottom: 15px;">
                        üåê Informa√ß√µes de Conex√£o
                    </h5>
                    <div style="background: rgba(0, 0, 0, 0.3); padding: 15px; border-radius: 8px; border-left: 4px solid #667eea;">
                        <code style="color: #e0e0e0; font-family: 'Courier New', monospace; font-size: 1rem;">
                            ${challenge.connection_info}
                        </code>
                    </div>
                </div>
            `;
        }
        
        const modalHTML = `
            <div class="modal fade" id="customChallengeModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
                <div class="modal-dialog modal-dialog-centered" style="max-width: 900px !important;">
                    <div class="modal-content" style="background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); border: 2px solid #FF8C00; border-radius: 15px; box-shadow: 0 0 30px rgba(255, 140, 0, 0.3);">
                        
                        <!-- Modal Header -->
                        <div class="modal-header" style="border-bottom: 1px solid rgba(255, 140, 0, 0.3); padding: 1.5rem;">
                            <div style="width: 100%;">
                                <!-- Badges -->
                                <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                                    <span class="badge" style="background: ${categoryColor}; padding: 8px 16px; border-radius: 20px; font-size: 0.85rem; font-weight: 600; text-transform: uppercase;">
                                        ${challenge.category}
                                    </span>
                                    <span class="badge" style="background: ${difficultyColor}; padding: 8px 16px; border-radius: 20px; font-size: 0.85rem; font-weight: 600; text-transform: uppercase;">
                                        ${difficultyBadge}
                                    </span>
                                </div>
                                
                                <!-- T√≠tulo -->
                                <h2 style="color: #FF8C00; font-family: 'Orbitron', sans-serif; font-size: 2rem; font-weight: 700; margin-bottom: 15px; text-shadow: 0 0 10px rgba(255, 140, 0, 0.5);">
                                    ${challenge.name}
                                </h2>
                                
                                <!-- Informa√ß√µes -->
                                <div style="display: flex; gap: 20px; color: #a0a0a0; font-size: 0.95rem;">
                                    <span style="display: flex; align-items: center; gap: 5px;">
                                        üèÜ <strong style="color: #FF8C00;">${challenge.value}</strong> pontos
                                    </span>
                                    <span style="display: flex; align-items: center; gap: 5px;">
                                        üë• <strong style="color: #FF8C00;">${challenge.solves || 0}</strong> resolu√ß√µes
                                    </span>
                                </div>
                            </div>
                            
                            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close" style="filter: brightness(0) saturate(100%) invert(57%) sepia(76%) saturate(1676%) hue-rotate(360deg) brightness(103%) contrast(105%); opacity: 1; font-size: 1.5rem;"></button>
                        </div>
                        
                        <!-- Modal Body -->
                        <div class="modal-body" style="padding: 2rem;">
                            
                            <!-- Descri√ß√£o -->
                            <div style="margin-bottom: 2rem; padding-left: 20px; border-left: 4px solid #FF8C00; background: rgba(255, 140, 0, 0.05); padding: 20px; border-radius: 8px;">
                                <p style="color: #e0e0e0; font-size: 1.05rem; line-height: 1.8; margin: 0;">
                                    ${challenge.description || 'Sem descri√ß√£o dispon√≠vel'}
                                </p>
                            </div>
                            
                            ${filesHTML}
                            ${connectionHTML}
                            
                            <!-- Submeter Flag -->
                            <div style="margin-bottom: 1rem;">
                                <h5 style="color: #FF8C00; font-family: 'Orbitron', sans-serif; font-size: 1.2rem; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                                    üö© Submeter Flag
                                </h5>
                                <form id="customChallengeSubmitForm">
                                    <div style="display: flex; gap: 15px; align-items: stretch;">
                                        <input 
                                            type="text" 
                                            id="customFlagInput"
                                            class="form-control" 
                                            placeholder="ALQMIA{sua_flag_aqui}" 
                                            required
                                            style="flex: 1; background: rgba(255, 255, 255, 0.05); border: 2px solid rgba(255, 140, 0, 0.3); color: #e0e0e0; padding: 15px 20px; border-radius: 8px; font-size: 1rem; transition: all 0.3s ease;"
                                        >
                                        <button 
                                            type="submit" 
                                            class="btn" 
                                            style="background: linear-gradient(135deg, #FF8C00 0%, #FFA500 100%); color: white; padding: 15px 40px; border-radius: 8px; font-weight: 700; font-size: 1rem; text-transform: uppercase; border: none; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(255, 140, 0, 0.4);"
                                        >
                                            SUBMETER
                                        </button>
                                    </div>
                                </form>
                                <div id="customChallengeFeedback" style="margin-top: 15px; padding: 12px 20px; border-radius: 8px; display: none; font-weight: 600;"></div>
                            </div>
                            
                        </div>
                        
                    </div>
                </div>
            </div>
        `;
        
        return modalHTML;
    }
    
    // Fun√ß√£o para submeter a flag
    async function submitFlag(challengeId, submission) {
        try {
            const response = await fetch('/api/v1/challenges/attempt', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'CSRF-Token': getCSRFToken()
                },
                body: JSON.stringify({
                    challenge_id: parseInt(challengeId),
                    submission: submission
                })
            });
            
            const result = await response.json();
            return result;
        } catch (error) {
            console.error('Erro ao submeter flag:', error);
            return { success: false, data: { status: 'error' } };
        }
    }
    
    // Fun√ß√£o para abrir o modal customizado
    async function openCustomChallengeModal(challengeId) {
        // Remover modal existente se houver
        const existingModal = document.getElementById('customChallengeModal');
        if (existingModal) {
            existingModal.remove();
        }
        
        // Buscar dados do desafio
        const challenge = await fetchChallengeData(challengeId);
        
        if (!challenge) {
            alert('Erro ao carregar desafio. Tente novamente.');
            return;
        }
        
        // Criar e inserir o modal no DOM
        const modalHTML = createCustomModal(challenge);
        document.body.insertAdjacentHTML('beforeend', modalHTML);
        
        // Inicializar o modal do Bootstrap
        const modalElement = document.getElementById('customChallengeModal');
        const modal = new bootstrap.Modal(modalElement);
        
        // Adicionar event listener para o formul√°rio de submiss√£o
        const form = document.getElementById('customChallengeSubmitForm');
        const feedback = document.getElementById('customChallengeFeedback');
        const input = document.getElementById('customFlagInput');
        
        form.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submission = input.value.trim();
            if (!submission) return;
            
            // Desabilitar bot√£o durante submiss√£o
            const submitBtn = form.querySelector('button[type="submit"]');
            submitBtn.disabled = true;
            submitBtn.textContent = 'ENVIANDO...';
            
            // Submeter flag
            const result = await submitFlag(challenge.id, submission);
            
            // Mostrar feedback
            feedback.style.display = 'block';
            if (result.success && result.data && result.data.status === 'correct') {
                feedback.style.background = 'linear-gradient(135deg, #11998e 0%, #38ef7d 100%)';
                feedback.style.color = 'white';
                feedback.textContent = '‚úÖ Correto! Parab√©ns!';
                
                // Recarregar a p√°gina ap√≥s 2 segundos
                setTimeout(() => {
                    window.location.reload();
                }, 2000);
            } else {
                feedback.style.background = 'linear-gradient(135deg, #eb3349 0%, #f45c43 100%)';
                feedback.style.color = 'white';
                feedback.textContent = '‚ùå Incorreto. Tente novamente!';
                
                // Reabilitar bot√£o
                submitBtn.disabled = false;
                submitBtn.textContent = 'SUBMETER';
                
                // Limpar feedback ap√≥s 5 segundos
                setTimeout(() => {
                    feedback.style.display = 'none';
                }, 5000);
            }
        });
        
        // Adicionar focus no input quando o modal abrir
        input.focus();
        
        // Limpar modal do DOM quando fechar
        modalElement.addEventListener('hidden.bs.modal', function() {
            modalElement.remove();
        });
        
        // Mostrar o modal
        modal.show();
    }
    
    // Interceptar cliques nos cards de desafios
    document.addEventListener('click', function(e) {
        const challengeCard = e.target.closest('[data-challenge-id]');
        if (challengeCard) {
            e.preventDefault();
            const challengeId = challengeCard.getAttribute('data-challenge-id');
            openCustomChallengeModal(challengeId);
        }
    });
    
    // Expor fun√ß√£o globalmente para uso externo se necess√°rio
    window.openCustomChallengeModal = openCustomChallengeModal;
    
})();
</script>
{% endblock %}

